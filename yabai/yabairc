# Aliases {{{
alias rule="yabai -m rule --add"
alias config="yabai -m config"
# }}}

# Global settings {{{
config mouse_follows_focus          off
config focus_follows_mouse          on
config window_placement             second_child
config window_topmost               off
config window_shadow                off
config window_opacity               off
config window_opacity_duration      2
config active_window_opacity        1.0
config normal_window_opacity        0.9
config window_border                on
config window_border_width          3
config active_window_border_color   0xffd5c4a1
config normal_window_border_color   0xff665c54
config insert_feedback_color        0xffd75f5f
config split_ratio                  0.50
config auto_balance                 off
config mouse_modifier               ctrl
config mouse_action1                move
config mouse_action2                resize
config mouse_drop_action            swap

# general space settings
config layout                       bsp
config top_padding                  40
config bottom_padding               8
config left_padding                 8
config right_padding                8
config window_gap                   8
# }}}


##############
# EXCEPTIONS #
##############
# Exceptions {{{

rule app="Préférences Système|Keka|Drop|Archetype Cory Wong|Spark|1Password|Messages|WebTorrent|Karabiner-Elements|Karabiner-EventViewer" manage=off
rule title="Discord Updater|Software Update|Fullscreen Controls" manage=off border=off
rule title='^Ouverture' manage=off layer=above
rule app='IINA' border=off
rule app='Sorted' title!='Sorted' border=off
rule app='Messages' border=on
# }}}


###############
# HOME LAYOUT #
###############
# Home layout {{{

if [ $(yabai -m query --displays | jq '. | length') = 2 ] ; then
	# Number of spaces on display 1
	d1s=$(yabai -m query --spaces --display 1 | jq length)

	# Firefox to space 1 of display 1
	rule app="Firefox" space=1

	# iTerm to space 2 of display 1
	rule app="iTerm" space=2

	# Spotify to space 1 of display 2
	rule app="Spotify" space=$(($d1s+1))

	# Discord to space 2 of display 2
	rule app="Discord" space=$(($d1s+2))

	# Twitterrific to space 3 of display 2
	rule app="Twitterrific" space=$(($d1s+3))

	# Messages to space 3 of display 2
	rule app="Messages" space=$(($d1s+3))
fi

# }}}

############
# EWWWWWWW #
############
# Eww {{{

yabai -m signal --add event=window_focused action='eww update yabai_active="$(yabai -m query --windows --window | jq -r .app) / $(yabai -m query --windows --window | jq -r .title)"'
yabai -m signal --add event=application_front_switched action='eww update yabai_active="$(yabai -m query --windows --window | jq -r .app) / $(yabai -m query --windows --window | jq -r .title)"'
yabai -m signal --add event=window_title_changed action='eww update yabai_active="$(yabai -m query --windows --window | jq -r .app) / $(yabai -m query --windows --window | jq -r .title)"'

yabai -m signal --add event=space_changed action='eww update spaces="$(~/.config/eww/spaces.sh)"'
yabai -m signal --add event=display_changed action='eww update yabai_active_space="$(yabai -m query --spaces --space | jq .index)"'

# }}}
